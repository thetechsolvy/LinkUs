<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkUs</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Logout Button -->
    <button id="logout-btn" style="
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 8px 16px;
        background-color: #f44336;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
    ">
        Logout
    </button>

    <!-- Login Popup -->
    <div id="auth-popup" class="popup">
        <div class="popup-content">
            <h2>Welcome Dearest!!</h2>
            <p>Please log in to continue:</p>
            <input type="email" id="email" placeholder="Enter your email" required />
            <input type="password" id="password" placeholder="Enter your password" required />
            <button id="login-btn">Log In</button>
            <div id="auth-message"></div>
        </div>
    </div>

    <!-- Main content (hidden until user is logged in) -->
    <div id="main-content" style="display: none;">
        <h1>This Is For Us!! Dear</h1>
        <!-- Image/Video Upload Form -->
        <form id="media-upload-form">
          
            <input type="file" id="media-file" accept="image/*,video/*" required />
              <input type="text" id="media-name" placeholder="Please Enter Title Dear" required />
            <button type="submit">Click To Upload</button>
        </form>
        <div id="upload-animation" style="display: none;">Uploading...</div>
        <div id="upload-alert"></div>

        <!-- Media Gallery -->
        <div id="image-gallery"></div>
    </div>

    <script type="module">
        // Import Firebase SDK modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-storage.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyASsh3wM3MeiPtGKnAkwkmoPHa-x0pMoP0",
            authDomain: "faceig-d3a18.firebaseapp.com",
            projectId: "faceig-d3a18",
            storageBucket: "faceig-d3a18.appspot.com",
            messagingSenderId: "1020122836188",
            appId: "1:1020122836188:web:415745a6846a1d4e909819",
            measurementId: "G-WXL32YF22J"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);
        const auth = getAuth();

        // Elements
        const authPopup = document.getElementById("auth-popup");
        const loginBtn = document.getElementById("login-btn");
        const emailInput = document.getElementById("email");
        const passwordInput = document.getElementById("password");
        const authMessage = document.getElementById("auth-message");
        const mainContent = document.getElementById("main-content");
        const mediaUploadForm = document.getElementById("media-upload-form");
        const uploadAnimation = document.getElementById("upload-animation");
        const uploadAlert = document.getElementById("upload-alert");
        const mediaGallery = document.getElementById("image-gallery");

        // Logout functionality
        document.getElementById("logout-btn").addEventListener("click", async () => {
            try {
                await signOut(auth);
                alert("You have successfully logged out.");
                location.reload();
            } catch (error) {
                console.error("Error logging out:", error);
            }
        });

        // Authentication State Listener
        onAuthStateChanged(auth, (user) => {
            if (user) {
                authPopup.style.display = "none";
                mainContent.style.display = "block";
                loadMedia();
            } else {
                mainContent.style.display = "none";
                authPopup.style.display = "block";
            }
        });

        // Handle Login
        loginBtn.addEventListener("click", async () => {
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();

            try {
                await signInWithEmailAndPassword(auth, email, password);
                authMessage.textContent = "Login successful!";
            } catch (error) {
                authMessage.textContent = "Error logging in: " + error.message;
            }
        });

        // Handle Media Upload (Image or Video)
        mediaUploadForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const mediaName = document.getElementById("media-name").value.trim();
            const file = document.getElementById("media-file").files[0];

            if (!auth.currentUser) {
                uploadAlert.textContent = "You must be logged in to upload media.";
                return;
            }

            if (!mediaName || !file) {
                alert("Please provide both media name and file.");
                return;
            }

            uploadAnimation.style.display = "block";
            uploadAlert.textContent = "";

            try {
                const mediaType = file.type.startsWith("video/") ? "video" : "image";
                const storageRef = ref(storage, `media/${Date.now()}_${file.name}`);
                
                // Upload file to Firebase Storage
                await uploadBytes(storageRef, file);
                const url = await getDownloadURL(storageRef);

                // Add document to Firestore
                await addDoc(collection(db, "media"), {
                    name: mediaName,
                    userId: auth.currentUser.uid,
                    url: url,
                    type: mediaType // Store type as "image" or "video"
                });

                uploadAlert.textContent = "Upload Successful!";
                mediaUploadForm.reset();
            } catch (error) {
                console.error("Error uploading media:", error);
                uploadAlert.textContent = "Upload Failed: " + error.message;
            } finally {
                uploadAnimation.style.display = "none";
                setTimeout(() => uploadAlert.textContent = "", 3000);
            }
        });

        // Load media from Firestore
        function loadMedia() {
            const mediaCollection = collection(db, "media");
            onSnapshot(mediaCollection, (snapshot) => {
                renderMedia(snapshot);
            });
        }

        // Render media in the gallery
        function renderMedia(snapshot) {
            mediaGallery.innerHTML = "";
            snapshot.forEach((docSnap) => {
                const media = docSnap.data();
                const card = document.createElement("div");
                card.classList.add("media-card");

                if (media.type === "image") {
                    // Display Image
                    card.innerHTML = `
                        <img src="${media.url}" alt="${media.name}" style="width: 100%; height: auto;">
                        <p><strong>Image Title:</strong> ${media.name}</p>
                    `;
                } else if (media.type === "video") {
                    // Display Video
                    card.innerHTML = `
                        <video controls style="width: 100%; height: auto;">
                            <source src="${media.url}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        <p><strong>Video Title:</strong> ${media.name}</p>
                    `;
                }

                mediaGallery.appendChild(card);
            });
        }
    </script>
</body>
</html>
